{"remainingRequest":"/Users/jameshsu/Documents/jameshsu3618/node_modules/babel-loader/lib/index.js!/Users/jameshsu/Documents/jameshsu3618/node_modules/eslint-loader/index.js??ref--13-0!/Users/jameshsu/Documents/jameshsu3618/src/itunessearchapi.js","dependencies":[{"path":"/Users/jameshsu/Documents/jameshsu3618/src/itunessearchapi.js","mtime":1564655513454},{"path":"/Users/jameshsu/Documents/jameshsu3618/node_modules/cache-loader/dist/cjs.js","mtime":1564287323436},{"path":"/Users/jameshsu/Documents/jameshsu3618/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/jameshsu/Documents/jameshsu3618/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["var _require = require('httpreq'),\n    doRequest = _require.doRequest;\n\nvar _require2 = require('es6-promisify'),\n    promisify = _require2.promisify;\n\nvar config = {\n  timeout: 5000,\n  idKeys: ['amgAlbumId', 'amgArtistId', 'amgVideoId', 'id', 'isbn', 'upc']\n};\n\nfunction httpError(err, res, message) {\n  var error = new Error(message);\n  error.code = res && res.statusCode;\n  error.body = res && res.body;\n  error.error = err;\n  return error;\n}\n\nfunction httpResponse(err, res, callback, firstResult) {\n  var data = res && res.body || '';\n  var error = null;\n\n  try {\n    data = JSON.parse(data);\n\n    if (!(data.results instanceof Array) || !data.results.length) {\n      error = new Error('no results');\n    } else if (firstResult) {\n      data = data.results[0];\n    }\n  } catch (e) {\n    error = httpError(e, res, 'invalid response');\n  }\n\n  if (err) {\n    error = httpError(err, res, 'http error');\n  }\n\n  if (error) {\n    callback(error);\n  } else {\n    callback(null, data);\n  }\n}\n\nfunction httpRequest(props, callback) {\n  var firstResult = false;\n  var options = {\n    url: 'https://itunes.apple.com/search',\n    method: 'POST',\n    parameters: props.params || {},\n    timeout: parseInt(props.timeout || config.timeout, 10),\n    headers: {\n      'User-Agent': 'itunessearchapi.js'\n    }\n  };\n  doRequest(options, function (err, res) {\n    httpResponse(err, res, callback, firstResult);\n  });\n}\n\nmodule.exports = promisify(function (params, timeout, callback) {\n  var options = {\n    params: params || {}\n  };\n\n  if (typeof timeout === 'function') {\n    callback = timeout;\n    timeout = null;\n  }\n\n  if (!params || !(params instanceof Object)) {\n    callback(new Error('invalid params'));\n    return;\n  }\n\n  options.params.version = params.version || 2;\n  options.timeout = timeout;\n  httpRequest(options, callback);\n});",{"version":3,"sources":["/Users/jameshsu/Documents/jameshsu3618/src/itunessearchapi.js"],"names":["require","doRequest","promisify","config","timeout","idKeys","httpError","err","res","message","error","Error","code","statusCode","body","httpResponse","callback","firstResult","data","JSON","parse","results","Array","length","e","httpRequest","props","options","url","method","parameters","params","parseInt","headers","module","exports","Object","version"],"mappings":"eAAsBA,QAAS,SAAT,C;IAAdC,S,YAAAA,S;;gBACcD,QAAS,eAAT,C;IAAdE,S,aAAAA,S;;AAER,IAAIC,SAAS;AACXC,WAAS,IADE;AAEXC,UAAQ,CACN,YADM,EAEN,aAFM,EAGN,YAHM,EAIN,IAJM,EAKN,MALM,EAMN,KANM;AAFG,CAAb;;AAYA,SAASC,SAAT,CAAoBC,GAApB,EAAyBC,GAAzB,EAA8BC,OAA9B,EAAuC;AACrC,MAAIC,QAAQ,IAAIC,KAAJ,CAAWF,OAAX,CAAZ;AAEAC,QAAME,IAAN,GAAaJ,OAAOA,IAAIK,UAAxB;AACAH,QAAMI,IAAN,GAAaN,OAAOA,IAAIM,IAAxB;AACAJ,QAAMA,KAAN,GAAcH,GAAd;AAEA,SAAOG,KAAP;AACD;;AAED,SAASK,YAAT,CAAuBR,GAAvB,EAA4BC,GAA5B,EAAiCQ,QAAjC,EAA2CC,WAA3C,EAAwD;AACtD,MAAIC,OAAOV,OAAOA,IAAIM,IAAX,IAAmB,EAA9B;AACA,MAAIJ,QAAQ,IAAZ;;AAEA,MAAI;AACFQ,WAAOC,KAAKC,KAAL,CAAYF,IAAZ,CAAP;;AAEA,QAAI,EAAEA,KAAKG,OAAL,YAAwBC,KAA1B,KAAoC,CAACJ,KAAKG,OAAL,CAAaE,MAAtD,EAA8D;AAC5Db,cAAQ,IAAIC,KAAJ,CAAW,YAAX,CAAR;AACD,KAFD,MAEO,IAAIM,WAAJ,EAAiB;AACtBC,aAAOA,KAAKG,OAAL,CAAc,CAAd,CAAP;AACD;AACF,GARD,CAQE,OAAOG,CAAP,EAAU;AACVd,YAAQJ,UAAWkB,CAAX,EAAchB,GAAd,EAAmB,kBAAnB,CAAR;AACD;;AAED,MAAID,GAAJ,EAAS;AACPG,YAAQJ,UAAWC,GAAX,EAAgBC,GAAhB,EAAqB,YAArB,CAAR;AACD;;AAED,MAAIE,KAAJ,EAAW;AACTM,aAAUN,KAAV;AACD,GAFD,MAEO;AACLM,aAAU,IAAV,EAAgBE,IAAhB;AACD;AACF;;AAED,SAASO,WAAT,CAAsBC,KAAtB,EAA6BV,QAA7B,EAAuC;AACrC,MAAIC,cAAc,KAAlB;AACA,MAAIU,UAAU;AACZC,SAAK,iCADO;AAEZC,YAAQ,MAFI;AAGZC,gBAAYJ,MAAMK,MAAN,IAAgB,EAHhB;AAIZ3B,aAAS4B,SAAUN,MAAMtB,OAAN,IAAiBD,OAAOC,OAAlC,EAA2C,EAA3C,CAJG;AAKZ6B,aAAS;AACP,oBAAc;AADP;AALG,GAAd;AAUAhC,YAAW0B,OAAX,EAAoB,UAACpB,GAAD,EAAMC,GAAN,EAAc;AAChCO,iBAAcR,GAAd,EAAmBC,GAAnB,EAAwBQ,QAAxB,EAAkCC,WAAlC;AACD,GAFD;AAGD;;AAGDiB,OAAOC,OAAP,GAAiBjC,UAAW,UAAC6B,MAAD,EAAS3B,OAAT,EAAkBY,QAAlB,EAA+B;AACzD,MAAIW,UAAU;AACZI,YAAQA,UAAU;AADN,GAAd;;AAIA,MAAI,OAAO3B,OAAP,KAAmB,UAAvB,EAAmC;AACjCY,eAAWZ,OAAX;AACAA,cAAU,IAAV;AACD;;AAED,MAAI,CAAC2B,MAAD,IAAW,EAAEA,kBAAkBK,MAApB,CAAf,EAA4C;AAC1CpB,aAAU,IAAIL,KAAJ,CAAW,gBAAX,CAAV;AACA;AACD;;AAEDgB,UAAQI,MAAR,CAAeM,OAAf,GAAyBN,OAAOM,OAAP,IAAkB,CAA3C;AACAV,UAAQvB,OAAR,GAAkBA,OAAlB;AACAqB,cAAaE,OAAb,EAAsBX,QAAtB;AACD,CAlBgB,CAAjB","sourcesContent":["const { doRequest } = require ('httpreq');\nconst { promisify } = require ('es6-promisify');\n\nlet config = {\n  timeout: 5000,\n  idKeys: [\n    'amgAlbumId',\n    'amgArtistId',\n    'amgVideoId',\n    'id',\n    'isbn',\n    'upc'\n  ]\n};\n\nfunction httpError (err, res, message) {\n  let error = new Error (message);\n\n  error.code = res && res.statusCode;\n  error.body = res && res.body;\n  error.error = err;\n\n  return error;\n}\n\nfunction httpResponse (err, res, callback, firstResult) {\n  let data = res && res.body || '';\n  let error = null;\n\n  try {\n    data = JSON.parse (data);\n\n    if (!(data.results instanceof Array) || !data.results.length) {\n      error = new Error ('no results');\n    } else if (firstResult) {\n      data = data.results [0];\n    }\n  } catch (e) {\n    error = httpError (e, res, 'invalid response');\n  }\n\n  if (err) {\n    error = httpError (err, res, 'http error');\n  }\n\n  if (error) {\n    callback (error);\n  } else {\n    callback (null, data);\n  }\n}\n\nfunction httpRequest (props, callback) {\n  let firstResult = false;\n  let options = {\n    url: 'https://itunes.apple.com/search',\n    method: 'POST',\n    parameters: props.params || {},\n    timeout: parseInt (props.timeout || config.timeout, 10),\n    headers: {\n      'User-Agent': 'itunessearchapi.js'\n    }\n  };\n\n  doRequest (options, (err, res) => {\n    httpResponse (err, res, callback, firstResult);\n  });\n}\n\n\nmodule.exports = promisify ((params, timeout, callback) => {\n  let options = {\n    params: params || {}\n  };\n\n  if (typeof timeout === 'function') {\n    callback = timeout;\n    timeout = null;\n  }\n\n  if (!params || !(params instanceof Object)) {\n    callback (new Error ('invalid params'));\n    return;\n  }\n  \n  options.params.version = params.version || 2;\n  options.timeout = timeout;\n  httpRequest (options, callback);\n});\n"]}]}